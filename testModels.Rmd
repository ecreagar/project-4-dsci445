---
title: "TestModels"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Installing a bunch of packages
library(ggplot2)
library(dplyr)
library(GGally)
library(ISLR)
library(caret)
library(MASS)
library(class)
library(knitr)
library(leaps)
library(glmnet)
library(boot)
library(gam)
library(tree)
library(gbm)
library(randomForest)
library(e1071)
library(splines)
```

```{r}
puntinfo = read.csv("Data/puntinfo.csv")
```

```{r}
colList = c("away_player_1", "away_player_2", "away_player_3", "away_player_4", "away_player_5", "away_player_6", "away_player_7", "away_player_8", "away_player_9", "away_player_10", "away_player_11", "home_player_1", "home_player_2", "home_player_3", "home_player_4", "home_player_5", "home_player_6", "home_player_7", "home_player_8", "home_player_9", "home_player_10", "home_player_11")

calcDistance <- function(x1, y1, x2, y2){
  distance = sqrt((x1-x2)^2 + (y1-y2)^2)
  return(distance)
}

for (i in 1:length(colList)){
  for(j in 1:nrow(puntinfo)){
    tempSplit = strsplit(puntinfo[j, colList[i]], ",")[[1]]
    tempX = as.numeric(substring(tempSplit[1], 2))
    tempY = as.numeric(substring(tempSplit[2], 2,nchar(tempSplit[2])-1))
    catchX = puntinfo[j, "field_position_x"]
    catchY = puntinfo[j, "field_position_y"]
    puntinfo[j, colList[i]] = calcDistance(tempX, tempY, catchX, catchY)
  }
}

puntinfo[9:30] <- sapply(puntinfo[9:30], as.numeric)
drop <- c("X","gameId", "playId", "specialTeamsResult" , "tackle_position_x", "tackle_position_y")
puntinfo <- puntinfo[,!(names(puntinfo) %in% drop)]
# puntinfo <- puntinfo[-4]
```

```{r}
noPlayerList = c("hangTime", "playDirection", "punt_position_x", "punt_position_y", "field_position_x", "field_position_y", "yards_gained")

awayPlayerList = c("away_player_1", "away_player_2", "away_player_3", "away_player_4", "away_player_5", "away_player_6", "away_player_7", "away_player_8", "away_player_9", "away_player_10", "away_player_11")

homePlayerList = c("home_player_1", "home_player_2", "home_player_3", "home_player_4", "home_player_5", "home_player_6", "home_player_7", "home_player_8", "home_player_9", "home_player_10", "home_player_11")

noPlayerDF = puntinfo[, (names(puntinfo) %in% noPlayerList)]
awayPlayerDF = puntinfo[, (names(puntinfo) %in% awayPlayerList)]
homePlayerDF = puntinfo[, (names(puntinfo) %in% homePlayerList)]

playerSorted = data.frame(matrix(ncol = 22, nrow=0))
colnames(playerSorted) = colList

for (i in 1:nrow(awayPlayerDF)){
  tempRowAway = sort(unlist(awayPlayerDF[i,], use.names = FALSE))
  tempRowHome = sort(unlist(homePlayerDF[i,], use.names = FALSE))
  tempRow = append(tempRowAway, tempRowHome)
  playerSorted[nrow(playerSorted)+1,] = tempRow
}

puntSorted = cbind(noPlayerDF, playerSorted)
```


```{r}
sample <- createDataPartition(puntSorted$yards_gained, p = 0.6, list = FALSE)

train <- puntinfo[sample,]
test <- puntinfo[-sample,]

xtrain <- model.matrix(yards_gained~., train)[,-1]
xtest <- model.matrix(yards_gained~., test)[,-1]
```


```{r}
testLm <- lm(yards_gained ~ ., data = train)

summary(testLm)

plot(testLm)

pred <- predict(testLm, test)

predTable <- data.frame(cbind(actuals=test$yards_gained, predicted=pred))

head(predTable)

ggplot(predTable, aes(x = actuals, y = predicted)) +
  geom_point() +
  geom_smooth(method='lm', formula = y~x)
```


```{r}
logitModel <- glm(yards_gained ~ ., data = train)

summary(logitModel)
```

```{r}
subsetMod <- regsubsets(yards_gained ~ ., data = puntinfo[,!(names(puntinfo) %in% drop)], nvmax = 20, method = "backward")

ggplot() +
    geom_point(aes(x = seq(1, 20), y = summary(subsetMod)$adjr2)) + 
    geom_line(aes(x = seq(1, 20), y = summary(subsetMod)$adjr2)) +
    ylab("AdjR2") +
    xlab("Size of Subset")

summary(subsetMod)
```

```{r}
# Issue when removing columns
lassoMod <- cv.glmnet(x = xtrain, y = train$yards_gained[1:nrow(train)-1], alpha = 1, nfolds = 10)

pred <- predict(lassoMod, s = lassoMod$lambda.min, newx = xtest)
mean((pred - test$yards_gained)^2)
```

```{r}
lambda <- 10^seq(-2, 10, length.out = 100)
ridgeMod <- cv.glmnet(x = xtrain, y = train$yards_gained[1:nrow(train)-1], alpha = 0, lambda = lambda)
ridgePred = predict(ridgeMod, xtest, s=ridgeMod$lambda.min)
mean((ridgePred - test$yards_gained)^2)
```


```{r}
gamMod <- gam(yards_gained ~ ., data = train)
summary(gamMod)


plot(x = puntinfo$away_player_4, y = puntinfo$yards_gained)
```

```{r}
treeModel <- tree(yards_gained ~., data = train)
summary(treeModel)
plot(treeModel)
text(treeModel)
```

```{r}

```

